# HNS-server
[NGINX](#nginx-instructions)  
[Varo Clone](varo)  
[MariaDB Replication (after Varo cloning)](#mariadb-instructions)  


# NGINX-Instructions
Run Installation script as below.  
Then add A record to point to your server and add the TLSA generated by the script to your DNS.  

Create a Linux server with TLD and SLD to one directory. This installs nginx as well as setup HNS domains
Change directory into the directory containing your website files.  
`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/new`  
`sudo chmod +x new`  
`sudo ./new <HNSDOMAIN>` # Use your TLD. This adds a wildcard so *.[HNSDOMAIN] will point to these files  

Add a new SLD (or dedicated TLD ONLY) to a previously setup Linux server. This uses the prexisting SSL Cert. So add the same TLSA as the previously generated one.  
Change directory into the directory containing your website files.  
`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/addsld`  
`sudo chmod +x addsld`  
`sudo ./addsld <HNSTLD> <HNSSLD>` #For example nathan.woodburn would be `sudo ./addsld woodburn nathan`  

TLD and SLD proxy to ICANN site. This installs nginx as well as setup HNS domains  

`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/proxy`  
`sudo chmod +x proxy`  
`sudo ./proxy <HNSDOMAIN> <target url>` # Use your TLD. This adds a wildcard so *.[HNSDOMAIN] will point to these files  
Example proxy *.3dprintingservice -> nathan3dprinting.au
`sudo ./proxy 3dprintingservice https://nathan3dprinting.au`
  
For a non wildcard use ./proxy-sld
Eg only proxy nathan.3dprintingservice
`sudo ./proxy-sld nathan.3dprintingservice https://nathan3dprinting.au`

Replace proxy with redirect to do a redirect instead of a mirror (proxy).

Forgot your TLSA record?  
`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/tlsa`  
`sudo chmod +x tlsa`  
`./tlsa <HNSTLD>`


<!-- # Varo-Clone
!! WARNING !!
This is a work in progress and still has some bugs.

Setup the backend first and use the output to setup the frontend.

## Backend
`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/varo/mutual.sh`  
`sudo chmod +x mutual.sh`  
`sudo ./mutual.sh`  

## Frontend
The frontend needs to be sent this information:  
IP of the backend  
LOCALPASS (generated and saved in /var/www/html/mutual/etc/password.txt)  
APIPASS (generated and saved in /var/www/html/mutual/etc/password.txt)  
ICANN Domain (Must have A record pointing to the frontend before running script or it will fail)  
HNS Domain  


`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/varo/dash.sh`  
`sudo chmod +x dash.sh`  
`sudo ./dash.sh <ICANN DOMAIN> <HNS DOMAIN> <LOCALPASS> <APIPASS> <IP OF BACKEND>`  

You need to edit the config file to add your websites name, SMTP settings (to send password resets) and stripe credentials (!This is needed to get the site working).  
`nano /var/www/html/dashboard/etc/config.php`  
Don't edit the passwords as they are generated and used by multiple processes.  

## Add Varo Admin

Add an admin to your varo installation. This gives them access to the admin panel.  
`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/varo/admin.sh`  
`sudo chmod +x admin.sh`  
`sudo ./admin.sh <user's email>`   -->

# MariaDB-Instructions

## Master  
If this is the first slave to add to the master, run the following commands.  
`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/sql/mbackup.sh`  
`sudo chmod +x mbackup.sh`  
`sudo ./mbackup.sh`  

If you have already setup a slave, then run the following commands.  
`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/sql/addbackup.sh`  
`sudo chmod +x addbackup.sh`  
`sudo ./addbackup.sh`  

## Slave
First you need these config from the master setup  
+ Master IP (Internal VPN or shared network is most secure)
+ Generated Password
+ Log
+ Pos

You also need the two database exports (varo.sql and pdns.sql) in the directory you are when running the script.  
`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/sql/sbackup.sh`  
`sudo chmod +x sbackup.sh`  
`sudo ./sbackup.sh <MASTER IP> <PASSWORD> <LOG> <POS>`  
