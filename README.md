# HNS-server
+ [NGINX HNS](#nginx-hns)  
+ [NGINX ICANN](#nginx-icann)  
+ [Varo Clone](varo)  
+ [MariaDB Replication (after Varo cloning)](#mariadb-instructions)  


# NGINX-HNS
Run Installation scripts as below.  
Then add A record to point to your server and add the TLSA generated by the script to your DNS.  

## Standard HNS domain with HTML content (TLD and Wildcard SLD)
This creates a website with TLD and SLD pointing to one directory.  
This installs nginx as well as setup HNS domains.  
Change directory into the directory containing your website files.  
`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/new`  
`sudo chmod +x new`  
`sudo ./new <HNSDOMAIN>`  
! Use your TLD. This adds a wildcard so *.[HNSDOMAIN] will point to these files  

## Standard HNS domain with HTML content (SLD or TLD only)
Same as above without wildcard.  
This uses the prexisting SSL Cert.  
So add the same TLSA as the previously generated one.  
Change directory into the directory containing your website files.  
`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/addsld`  
`sudo chmod +x addsld`  
`sudo ./addsld <HNSTLD> <HNSSLD>` #For example nathan.woodburn would be `sudo ./addsld woodburn nathan`  

## Proxy HNS domain to ICANN site (TLD and Wildcard SLD)
This will create a mirror of the ICANN site showing the Handshake domain in the url bar.

`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/proxy`  
`sudo chmod +x proxy`  
`sudo ./proxy <HNSDOMAIN> <target url>`  
! Use your TLD. This adds a wildcard so *.[HNSDOMAIN] will point to these files  
Example proxy *.3dprintingservice -> nathan3dprinting.au  
`sudo ./proxy 3dprintingservice https://nathan3dprinting.au`  

## Proxy HNS domain to ICANN site (SLD or TLD only)
This will create a mirror of the ICANN site showing the Handshake domain in the url bar.  
This will only proxy the provided SLD or TLD.  
Eg only proxy nathan.3dprintingservice  
`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/proxy-sld`
`sudo chmod +x proxy-sld`
`sudo ./proxy-sld nathan.3dprintingservice https://nathan3dprinting.au`  

## Redirect HNS domain to ICANN site (TLD and Wildcard SLD)
Replace proxy with redirect to do a redirect instead of a mirror (proxy).  
`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/redirect`   
`sudo chmod +x redirect`  
`sudo ./redirect <HNSDOMAIN> <target url>`  
! Use your TLD. This adds a wildcard so *.[HNSDOMAIN] will point to these files  


## Redirect HNS domain to ICANN site (SLD or TLD only)
Replace proxy with redirect to do a redirect instead of a mirror (proxy).  
`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/redirect-sld`  
`sudo chmod +x redirect-sld`  
`sudo ./redirect-sld nathan.3dprintingservice https://nathan3dprinting.au`  


## Forgot your TLSA record?  
This script will find the TLSA record for you.  
`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/tlsa`  
`sudo chmod +x tlsa`  
`./tlsa <HNSTLD>`

# NGINX-ICANN

## Standard ICANN domain with HTML content
First add A record to point to your server so Letsencrypt can generate you SSL cert.  
Then run this script  
`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/newicann`  
`sudo chmod +x newicann`  
`sudo ./newicann <DOMAIN>`  

## Proxy ICANN domain to another ICANN site
Eg proxy 3dprinting.woodburn.au -> nathan3dprinting.au  
`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/proxyicann`  
`sudo chmod +x proxyicann`  
`sudo ./proxyicann 3dprinting.woodburn.au https://nathan3dprinting.au`  

## Redirect ICANN domain to another ICANN site
Eg redirect 3dprinting.woodburn.au -> nathan3dprinting.au  
`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/redirecticann`  
`sudo chmod +x redirecticann`  
`sudo ./redirecticann 3dprinting.woodburn.au https://nathan3dprinting.au`  


# MariaDB-Instructions

## Master  
If this is the first slave to add to the master, run the following commands.  
`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/sql/mbackup.sh`  
`sudo chmod +x mbackup.sh`  
`sudo ./mbackup.sh`  

If you have already setup a slave, then run the following commands.  
`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/sql/addbackup.sh`  
`sudo chmod +x addbackup.sh`  
`sudo ./addbackup.sh`  

## Slave
First you need these config from the master setup  
+ Master IP (Internal VPN or shared network is most secure)
+ Generated Password
+ Log
+ Pos

You also need the two database exports (varo.sql and pdns.sql) in the directory you are when running the script.  
`wget https://raw.githubusercontent.com/Nathanwoodburn/HNS-server/main/sql/sbackup.sh`  
`sudo chmod +x sbackup.sh`  
`sudo ./sbackup.sh <MASTER IP> <PASSWORD> <LOG> <POS>`  
